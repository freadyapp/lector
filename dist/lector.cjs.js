"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("pragmajs"),e=require("animejs"),i=require("compromise");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}require("mousetrap");var s=n(e),o=n(i);function a(e){return e instanceof t.Pragma&&(e=e.element),e.isPragmaElement||(e=t._e(e)),e}function r(e,i=100){if(!e)throw t.util.throwSoft(`couldnt not evaluate if [${e}] is on screen`);e=a(e);let n=window.scrollY;return function(t,e={}){let i=t.offset(),n=i.top,s=i.top+t.rect().height;return n<=e.bot&&s>=e.top||n<=e.top&&s>=e.bot}(e,{top:n+i,bot:n+window.innerHeight-i})}function l(t,e=200,i=200){return t=a(t),new Promise(((n,o)=>{const a=window.document.scrollingElement||window.document.body||window.document.documentElement,r=t.offset().top-i;s.default({targets:a,scrollTop:r,duration:e,easing:"easeInOutSine"}).finished.then((()=>{setTimeout(n,20)}))}))}function c(e){globalThis.lectorSpace.scrollChain||(t.util.createChains(globalThis.lectorSpace,"scroll"),function(t){let e=0,i=!1;document.addEventListener("scroll",(function(n){let s=e;e=window.scrollY,i||(window.requestAnimationFrame((function(){t(e,e-s),i=!1})),i=!0)}))}(((t,e)=>{globalThis.lectorSpace.scrollChain.exec(t,e)}))),globalThis.lectorSpace.onScroll(e)}function h(e){globalThis.lectorSpace.scrollEndChain||(t.util.createChains(globalThis.lectorSpace,"scrollEnd"),function(t){let e,i={s:null,ds:null};c(((n,s)=>{i={s:n,ds:s},e&&clearTimeout(e),e=setTimeout((e=>{t(i.s,i.ds)}),50)}))}(((t,e)=>{globalThis.lectorSpace.scrollEndChain.exec(t,e)}))),globalThis.lectorSpace.onScrollEnd(e)}globalThis.lectorSpace=globalThis.lectorSpace||{};const p=["an","an","ap","di","dy","ec","eg","en","em","eo","ep","eu","id","is","my","ne","od","oo","ot","sy","ur","ur","zo","pto","pyl","acr","aer","agr","ana","ant","apo","aut","bar","bio","cac","cat","cen","cen","con","cub","cyn","dec","dek","dem","dia","dox","eco","ego","eme","eos","epi","erg","eso","eth","eur","exo","geo","gen","hem","hal","hen","hex","hod","hol","hor","hor","hyo","hyp","ide","idi","iso","kil","lei","lep","lip","log","meg","mei","men","mer","mes","mim","mis","mit","mne","mon","myx","nes","nom","oct","oed","oen","omm","ont","opt","pan","pam","par","ped","pin","pis","pol","por","pro","rhe","sei","sit","syn","syl","sym","tax","the","the","tom","ton","top","tox","tri","ulo","uro","uro","xen","xer","zon","zyg","psil","prot","pros","amph","anem","anti","anth","arct","astr","athl","auto","basi","bibl","briz","brom","brom","call","carp","carp","cata","chir","cine","cirr","clad","clav","coel","copr","cosm","crep","cris","crit","cten","cyan","cycl","cyst","deca","deka","delt","derm","dexi","dino","dipl","ecto","endo","engy","eoso","etho","ethi","ethm","ethn","etym","fant","glia","gram","gymn","haem","hapl","heli","hemi","hept","herp","heur","hipp","home","horm","hyal","hydr","hygr","hypn","icos","kine","lamp","leps","leuc","leuk","lith","metr","meta","micr","myri","myth","narc","naut","necr","nect","nema","neur","noth","noto","oeco","ogdo","olig","onom","ophi","orch","orth","pach","paed","pale","path","patr","pect","pent","pept","peri","petr","phae","phag","pher","phil","phob","phon","phor","phos","phot","phyl","phys","plac","plas","plec","plut","pneu","poie","pole","poli","poli","poly","raph","rhag","rhig","rhin","rhiz","rhod","sarc","scel","scop","sema","siph","soma","soph","stea","steg","sten","stig","stom","styl","tach","tars","taur","tele","tele","temn","tetr","than","thus","ther","thym","thyr","trag","trit","trop","xiph","proct","ptych","amphi","arche","archi","arche","arist","arthr","bathy","batho","blenn","blast","botan","brady","bront","calli","calyp","cardi","centr","ceram","cerat","chlor","chore","chrom","chron","chrys","clast","clist","cochl","corac","cotyl","crani","cross","crypt","dendr","dodec","dynam","ennea","gastr","graph","heter","homal","hyper","klept","lekan","macro","melan","meter","morph","nephr","nomad","odont","organ","osteo","palae","palin","peran","phleg","phloe","phren","phryn","phyll","plagi","platy","plesi","pleth","pleur","pogon","polem","potam","rhabd","rhomb","scaph","schem","schis","scler","scoli","scept","scyph","selen","solen","sperm","sphen","spher","stern","stich","stoch","taeni","techn","therm","thyre","traum","trema","trich","troch","troph","xanth","psych","archae","brachi","brachy","bronch","cathar","cephal","chelon","cleist","cosmet","cylind","dactyl","deuter","dogmat","erythr","galact","hendec","ichthy","mening","myrmec","omphal","opisth","opoter","ornith","ostrac","persic","phalar","phaner","phragm","plinth","prasin","presby","rhynch","scalen","strept","stroph","thalam","theori","trachy","trapez","tympan","aesthet","anthrop","branchi","cleithr","epistem","parthen","phalang","pharmac","porphyr","sacchar","sphinct","stalact","stalagm","thalass","oesophag","ophthalm","physalid","pentecost","treiskaidek"];function d(t){return t<=1?4:t<=7?2/6*(t-1)+4:t<=8?1*(t-7)+6:3/8*(t-8)+7}function u(t){let e=0,i=o.default(t.text);i.has("#Verb")&&(e+=.5),i.has("#Acronym")&&(e+=.8);let n=function(t){let e=t.length;if(e<5)return 0;for(let i of p){if(i.length>=e-3)return 0;if(i==t.substring(0,i.length))return i.length}return 0}(t.text);return n>1&&(e+=n/10),Math.min(1,Math.min(e,1))}function g(t,e){return d(t.text.length)*(e+1)}function m(t){return 1e3/(t/60*4.7)}class f{constructor(t){let e=null,i=null;const n=new Promise(((n,s)=>(e=s,i=n,t(n,s))));return n.cancel=e,n.resolve=i,n}}class v{constructor(t){this.afkChain=new Map,this.activeChain=new Map,this.idleTime=t,this.isIdle=!1;["load","mousemove"].forEach((t=>{window.addEventListener(t,(t=>this.reset()))}))}generateActionKey(t){return null==t&&(t=this.afkChain.size),t}onAfk(t,e){return this.afkChain.set(this.generateActionKey(e),t),this}onActive(t,e){return this.activeChain.set(this.generateActionKey(e),t),this}reset(){return clearTimeout(this.t),this.t=setTimeout((()=>this.idle()),this.idleTime),this.active(),this}idle(){return!this.isIdle&&(this.isIdle=!0,b(this.afkChain),this)}active(){return!!this.isIdle&&(this.isIdle=!1,b(this.activeChain),this)}}function b(t){for(const[e,i]of t.entries())i()}function w(e){if(!e)return!1;if(0===(e=t._e(e)).textContent.length)return!1;let i="";for(let t of e.textContent.split(" ")){i+=0!=t.replace(/\s/g,"").length?"<w>"+t.split(" ").join("</w> <w>")+"</w> ":t}e.html(i)}function x(e){let i=(e=t._e(e)).findAll("*");if(0==i.length)return w(w(e));i.forEach((t=>x(t)))}function y(e){let i=(e=t._e(e)).findAll("*");return 0==i.length?x(e):(i.forEach((t=>y(t))),!0)}const _=8,C=8;function k(t=0,e=0){return e>_?t:t*(_-e)/C+t}function T(t,e,i){for(var n=[t],s=t;s<e;)n.push(s+=i||1);return n}function P(e,i){let n=(i=t._e(i)).rect().x,s=i.rect().y,o=i.rect().width,a=i.rect().height;console.log(e,i.offset());let r=n<e.x&&n+o>e.x,l=s<e.y&&s+a>e.y;return r&&l}function E(t){return t.css("\n        opacity 0\n    "),t.addClass("collapsed"),t.setData({collapsed:!0}),t}function L(t){t.css("\n        opacity 1 \n    "),t.removeClass("collapsed"),t.setData({collapsed:!0})}var M=Object.freeze({__proto__:null,PinkyPromise:f,Idle:v,range:T,isClickWithin:P,collapse:E,expand:L,fadeTo:function(e,i,n=500){return(e=t._e(e)).css(`\n    transition opacity ${n}ms \n    opacity ${i}\n  `),new Promise((t=>{setTimeout((()=>{0==i?e.hide():e.show(),t()}),n)}))},isOnScreen:r,isMostlyInScreen:function(e,i=.5){if(!e)throw t.util.throwSoft(`couldnt not evaluate if [${e}] is on screen`);return r(e=a(e),i*e.rect().height)},scrollTo:l,onScroll:c,crush:d,generateDifficultyIndex:u,wordValue:g,charsMsAt:m,wfy:y,airway:k});class S extends t.Pragma{constructor(){super(arguments)}get lector(){return this}get mark(){return this._mark}set mark(t){this.adopt(t),this._mark=t}get settings(){return this._settings}set settings(t){this.adopt(t),this._settings=t}get isReading(){return this.w.isReading}get currentWord(){return this.w.currentWord}get currentParent(){return this.currentWord.parent}connectTo(t){return this.w=t,this.add(t),this}removeWord(t){this.w.remove(t)}addWord(t,e=!1){return t.value=t.value??0,this.w.add(t),this}toggle(){return this.isReading?this.pause():this.read()}read(){if(t.util.log("::LECTOR reading",this),!this.w.hasKids)return console.error("nothing to read");this.w.read(!0)}summonTo(t){this.currentParent.value+=t,this.currentWord.summon()}goToNext(){this.summonTo(1)}goToPre(){this.summonTo(-1)}pause(){this.w.pause()}setFont(t){this.w.css(`font-family ${t}`)}}class A extends t.Pragma{constructor(t){super(t),this.do((function(){this.hasKids&&this.parent&&(this.parent.value=this.key)}))}destroy(){return this.childMap=null,null}get lector(){if(this.parent)return this.parent.lector;t.util.throwSoft("could not find lector for")}get txt(){return this.text}get index(){return parseInt(this.key)}get mark(){return this.parent?this.parent.mark:null}set mark(t){return this.parent&&(this.parent.mark=t),null}get isReading(){return null!=this.currentPromise}get currentWord(){if(!this.hasKids)return this;let e=this.get(this.value);return e?e.currentWord:t.util.throwSoft(`Could not find current Word of ${this.key}`)}getFromBottom(t){return this.get(this.kidsum-t)}sibling(t){if(!this.parent)return null;let e=this.parent.get(this.index+t);return e||("function"!=typeof this.parent.sibling?null:t<0?this.parent.sibling(-1).getFromBottom(t):this.parent.sibling(1)?.get(t))}get next(){return this.sibling(1)}get pre(){return this.sibling(-1)}isInTheSameLine(t){return null!=this.sibling(t)&&(this.sibling(t).top-this.top)**2<10}get isFirstInLine(){return!this.isInTheSameLine(-1)}get isLastInLine(){return!this.isInTheSameLine(1)}time(t=250){return m(t)*g(this,u(this))}pause(){return new f((t=>{this.currentPromise?(this.currentPromise.catch((e=>{this.mark.pause().catch((t=>{console.warn("prevent pause event from bubbling. Chill on the keyboard bro",t)})).then((()=>{this.currentPromise=null,t("done pausing"),console.log("- - - - - PAUSED - - - - - - - -")}))})),this.currentPromise.cancel("pause")):t("already paused")}))}set currentPromise(t){if(this.parent)return this.parent.currentPromise=t;this.currentPromiseVal=new f(((e,i)=>{t.catch((t=>{console.warn(t)})).then((()=>{e(),this.currentPromiseVal=null}))}))}get currentPromise(){return this.parent?this.parent.currentPromise:this.currentPromiseVal}promiseRead(t){return this.currentPromise=new f(((e,i)=>{function n(){let n=t?500:null;this.mark.guide(this,n).then((()=>{console.timeEnd(this.text),this.parent.value=this.index+1,e(` read [ ${this.text} ] `)})).catch((t=>{console.warn("rejected promise read",t),i(t)}))}console.time(this.text);let s=this;t?new Promise((t=>{t()})).then((t=>{n.bind(s)()})):n.bind(s)()})),this.currentPromise}read(t=!1){return this.currentPromise?new Promise(((t,e)=>{t("already reading")})):this.hasKids?this.currentWord?this.currentWord.read(t):(this.next.value=0,this.next.read()):(this.promiseRead(t),new f((t=>{this.currentPromise.then((()=>(t(),this.currentPromise=null,this.parent.read()))).catch((e=>t("pause")))})))}summon(t=!1){return!this.hasKids&&(console.log("SUMMONING",this),this.parent.pause().catch((()=>console.log("no need to pause"))).then((()=>{this.mark.mark(this,50,!1),t||(this.parent.value=this.index)})))}}const O={hotbox:t=>`background ${t}`,underneath:t=>` background transparent\n                        border-bottom 3px solid ${t}\n                        border-radius 4px`,faded:t=>`\n      background: rgb(255,255,255);\n      background: -moz-linear-gradient(90deg, rgba(255,255,255,0) 0%, ${t} 25%, ${t} 75%, rgba(255,255,255,0) 100%);\n      background: -webkit-linear-gradient(90deg, rgba(255,255,255,0) 0%, ${t} 25%, ${t} 75%, rgba(255,255,255,0) 100%);\n      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, ${t} 25%, ${t} 75%, rgba(255,255,255,0) 100%);\n    `};const I=(t,e=t._mode,i=t._color)=>{if(!i)return util.throwSoft("could not mode_ify");let n=function(t,e){return"border 0\n               border-radius 3px\n               z-index 10\n               opacity 1\n               mix-blend-mode darken;"+O[t](e)}(e=(e||"hotbox").toString().toLowerCase(),i);return t&&t.css(n),n},F={"#a8f19a":"Grass","#eddd6e":"Pasta","#edd1b0":"Floor","#96adfc":"Water"},D=Object.keys(F),$=["Helvetica","Open Sans","Space Mono"],V=["HotBox","Underneath","Faded"],z={HotBox:"marker is a block",Underneath:"marker is slim and underneat the words",Faded:"marker's boundaries loose their essence"},j="#eddd6e",H="Faded",W=4,N=250;class B extends t.Pragma{constructor(){super("marker"),this.element=t._e("marker"),this.appendTo("body"),this.hide(),this.css("\n  position absolute\n  outline solid 0px red\n  background-color #ffdf6c\n  width 10px\n  height 20px\n  z-index 10\n  opacity 1\n  mix-blend-mode darken\n  border-radius 3px\n"),this.currentlyMarking=null,window.addEventListener("resize",(()=>{this.mark(this.last_marked,0)})),this.runningFor=0,this.pausing=!1,this.setColor(j),this.setMode(H),this.setWpm(N),this.setFovea(W)}hide(){this._hidden||(this._hidden=!0,this.element.hide())}show(){this._hidden&&(this._hidden=!1,this.element.show())}set last_marked(t){this.value=t}get last_marked(){return this.value}get settings(){return this.parent?this.parent.settings:console.error("mark has no settings attached")}get cw(){return 30*this._fovea}get wpm(){return this._wpm||260}setMode(t){this._mode=t,I(this)}setWpm(t){this._wpm=t}setColor(t){this._color=t,I(this)}setFovea(t){this._fovea=t,this.css(`width ${this.cw}px`)}pause(){return new Promise(((t,e)=>{if(this.pausing)return e("already pausing");if(this.pausing=!0,this.currentlyMarking&&this.current_anime&&this.last_marked){let i=this.last_marked;console.log("mark was running for",this.runningFor),this.runningFor=0,this.current_anime.complete(),this.current_anime.remove("marker"),this.mark(i,80,!1).then((()=>{t("paused")})).catch((t=>{e("could not mark")})).then((t=>{this.pausing=!1}))}}))}moveTo(t,e,i=(()=>{})){return console.log("moving to",t),this.show(),this.currentlyMarking?new Promise(((t,e)=>t())):new Promise(((n,o)=>{this.currentlyMarking=t,this.current_anime=s.default({targets:this.element,left:t.left,top:t.top,height:t.height,width:t.width,easing:t.ease||"easeInOutExpo",duration:e,complete:t=>{this.currentlyMarking=null,i(),n()}})}))}mark(e,i=200,n=!1,s="easeInOutExpo"){if(!(e instanceof t.Pragma))return new Promise((t=>{console.warn("cannot mark"),t("error")}));let o=n?e.width+5:this.cw;return this.moveTo({top:e.top,left:e.x(o),height:e.height,width:o,ease:s},i,(()=>{this.last_marked=e}))}guide(e,i){return e instanceof t.Pragma?new f(((t,n)=>{let s=e.isFirstInLine?"easeInOutExpo":"linear";return this.moveTo({top:e.top,left:e.x(this.width)-e.width/2,height:e.height,width:this.cw,ease:s},i||this.calcDuration(e,1)).then((()=>{this.last_marked=e,this.runningFor+=1,this.mark(e,this.calcDuration(e,2),!1,"linear").then((()=>{t()}))}))})):new Promise(((t,e)=>{console.warn("cannot guide thru"),e("error")}))}calcDuration(e,i=1){if(!(e instanceof t.Pragma))return this.throw(`Could not calculate marking duration for [${e}] since it does not appear to be a Pragma Object`);if(1!=i&&2!=i)return this.throw(`Could not calculate duration for ${e.text} since dw was not 1 or 2`);if(e.isFirstInLine)return 500;if(!this.last_marked)return 0;const n=1==i?.4:.6;let s=(1==i?this.last_marked:e).time(this.wpm);return[t=>t*n,k].forEach((t=>{s=t(s,this.runningFor)})),s}}function R(e,i,n={}){return t._p("infinity paginator").from(function(e,i={}){return(new t.Pragma).from(t.util.createTemplate({pageTemplate:e,firstPage:i.first,lastPage:i.last,fetch:"function"==typeof i.fetch?i.fetch:e=>{t.util.throwSoft("no fetch source specified")},onCreate:"function"==typeof i.onCreate?i.onCreate:e=>t.util.log("created",e),onFetch:i.onFetch,onPageAdd:null,onPageRender:null,onPageActive:"function"==typeof i.onPageActive?i.onPageActive:function(e,i){t.util.log("active",e)},onPageInactive:"function"==typeof i.onPageInactive?i.onPageInactive:function(e,i){t.util.log("inactive",e)}})).run((function(){let e=t._e(this.pageTemplate).hide();this.pageTemplate=e.cloneNode(!1),this._clonePage=function(){let e=t._e(this.pageTemplate.cloneNode(!1)).show();return this.adopt(e),e.lec=this.parent,t.util.createEventChains(e,"fetch"),e},this.isPageAvailable=t=>(!this.firstPage||t>=this.firstPage)&&(!this.lastPage||t<=this.lastPage),this.create=function(t=this.value,e="append"){let n=this._clonePage();new Promise((e=>{this.onCreate(n,t);let s=this.fetch(t),o=i.onFetch||function(t,i){t.html(i),e(t)};const a=i=>{let n=this.pages.get(t);n&&(o(n,i),e(n))};s instanceof Promise?s.then((t=>{a(t)})):a(s)})).then((e=>{e.fetchChain.exec(),this.onPageRender&&this.onPageRender(e,t)})),n[`${e}To`](this.parent.element),this.addPage(n,t)},this.pages=new Map,this.destroy=function(t){let e=this.pages.get(t),i=i=>{e=this.pages.get(t),this.delPage(t),e.destroy()};if(this.onPageDestroy){let n=this.onPageDestroy(e,t);if(n instanceof Promise)return n.then(i)}i()},this.addPage=function(t,e){e=null===e?this.pages.size:e,this.onPageAdd&&this.onPageAdd(t,e),this.pages.set(e,t)},this.delPage=function(t){return this.pages.delete(t)},this.activate=function(...t){t.forEach((t=>{let e=this.pages.get(t);e&&(e.active=!0,this.onPageActive(e,t))}))},this.inactivate=function(...t){t.forEach((t=>{let e=this.pages.get(t);e&&(e.active=!1,this.onPageInactive(e,t))}))},this.export("pageTemplate","_clonePage","create","destroy","pages","addPage","delPage","activate","firstPage","lastPage","isPageAvailable","inactivate")}))}(i,t.util.objDiff({streamer:e,fetch:e.fetch},n))).setValue(0).run({initialConfig(){this._watching=!0;const e=10,i=5;this.fill=function(){this.fetching=!0;let n=T(this.value>=e?this.value-e:0,this.value+e);console.log(n),n=n.filter((t=>this.isPageAvailable(t))),console.log(n);let s=Array.from(this.pages.keys()),o=t.util.aryDiff(n,s),a=t.util.aryDiff(s,n),r=o.filter((t=>t>this.value)),l=t.util.aryDiff(o,r);console.log(">> DEL",a),console.log(">> ADD AFTER",r),console.log(">> ADD BEFORE",l),t.runAsync((t=>{for(let t of r)this.create(t,"append")}),(t=>{for(let t of l.reverse())this.create(t,"prepend")}),(t=>{for(let t of a)this.destroy(t)})),setTimeout((t=>{this.fetching=!1,console.log(this.pages)}),i)}},scrollSetup(){this.goTo=function(t,e){this.value;let i=this;this.value!=t&&(this.value=t);let n=this.pages.get(t);n.onRender((function(){i._watching=!1,l(n,e||20).then((()=>{i._watching=!0}))}))},this.export("goTo")},findActivePages(){this.findActivePage=function(t,e){return new f((e=>{e(function(t,e){let i=null,n=999999999999;const s=e+window.innerHeight/2;for(let[e,o]of t){let t=o.top+o.height/2,a=Math.abs(t-s);a<=n&&(n=a,i=e)}return i}(this.pages,t))}))};let t=!1,e=!1;const i=(n,s)=>{if(!this.fetching&&this._watching){if(t)return e={pos:n,dp:s};t=!0,this.findActivePage(n,s).then((n=>{this.value=n,t=!1,e&&(i(e.pos,e.dp),e=null)}))}};h(((t,e)=>{i(t,e)})),c(((t,e)=>{Math.abs(e)>40&&t<350&&i(t,e)}))}}).do((function(){if(0===this.dv)return;this.activate(this.value);let t=this.value-(this.dv||1);this.inactivate(t),this.fill()}))}const Z={onOptionCreate:function(t,e){t.contain(e)},optionTemplate:function(e){return t._p(e).html(e).addClass("pragma-click").listenTo("click",(function(){this.parent.value=this.key}))}};function U(e){let i=e.options;if(!i)return t.util.throwSoft("need to define options when creating a select template");let n=e.onOptionCreate||Z.onOptionCreate,s=e.optionTemplate||Z.optionTemplate;if(i.constructor===Array)for(let t of i){let e=s(t);e._isOption=!0,n(this,e)}else for(let[t,e]of Object.entries(i)){const i={[t]:e};n(this,s(t,e),i)}this.getOptions=function(){return console.log(this.children),this.children.filter((t=>t._isOption))}}var K='@charset "utf-8";body{background-color:#161616}',q='@charset "utf-8";.pragma-slider{user-select:none;cursor:grab}.pragma-slider:active{cursor:grabbing}.pragma-slider-bg{width:100%;height:5px;background:#6F6F6F;border-radius:15px}.pragma-slider-bar{height:100%;width:100%;background:#2B6CCE;position:relative;transition:all .05s ease;border-radius:15px}.pragma-slider-thumb{width:5px;height:18px;background:#2b6cce;transition:all .05s ease;position:absolute;right:0;top:50%;bottom:50%;margin:auto}',G="@charset \"utf-8\";@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300&display=swap);@import url(https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600;700&display=swap);.glass-block,.lector-mini-settings,.glass-block-border{background:rgba(35,35,35,0.55);backdrop-filter:blur(22px);-webkit-backdrop-filter:blur(22px);border-radius:5px;padding:20px 40px;color:whitesmoke}.glass-block-border{border:1px solid rgba(255,255,255,0.18)}.fixed-bottom-box,.lector-mini-settings,.lector-settings{position:fixed;bottom:20px}.lector-settings .pop-up-settings{background-color:#262626;border-radius:5px;left:-10px;transition:all .2s;padding:20px 5px 11px 5px;margin-left:10px;font-family:'Poppins','Inter','Arial Narrow',Arial,sans-serif;width:200px;margin-bottom:10px}.lector-settings .pragma-input-element{display:flex;flex-direction:column;width:fit-content;justify-content:center}.lector-settings .section{margin:20px 0}.lector-settings .section:hover>.pragma-label{opacity:1}.lector-settings .section .pragma-label{opacity:0;transition:all .2s ease;position:absolute;left:25%;margin-top:-55px;font-size:12px;color:whitesmoke}.lector-settings .section .pragma-label .option-title{color:rgba(199,199,199,0.92)}.lector-settings .selector,.lector-settings .selector-fovea,.lector-settings .selector-mode{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center;align-content:stretch;width:fit-content;border-radius:4px;overflow:hidden}.lector-settings .selector-mode{padding:0;color:#262626;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:center;align-content:center;left:-7%;top:-70px}.lector-settings .selector-fovea{width:130px;height:45px;left:-9%;top:-70px;z-index:45678;margin-right:9px}.lector-settings .setting,.lector-settings .setting-wpm{width:100%;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-around;align-items:center;align-content:stretch}.lector-settings .setting .setting-icon,.lector-settings .setting-wpm .setting-icon{width:35px;height:35px}.lector-settings .setting-wpm{border-radius:5px;left:-10px;transition:all .2s;margin-left:20px;font-family:'Poppins','Inter','Arial Narrow',Arial,sans-serif;width:125px;position:relative}.lector-settings .setting-wpm .speed-adjust{width:10px}.lector-settings .setting-wpm .speed-adjust .adjusticon{width:10px;height:20px}.lector-settings .setting-wpm::before{content:\"\";position:absolute;height:30px;width:1px;background-color:#6F6F6F;left:-10px}.lector-settings .settings-bar{background-color:#262626;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-around;align-items:center;align-content:stretch;margin-left:10px;padding:5px 0 5px 10px;border-radius:5px;width:200px}.lector-settings .settings-bar-icon{width:25px;height:25px;position:relative;cursor:pointer}.lector-settings .wpm-icon{color:#fff;opacity:65%;font-size:28px;line-height:45px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.lector-settings .wpm-icon:hover{opacity:100%;transition:all ease .1s}.lector-settings .color-indicator{width:25px;height:25px;background-color:#a8f19a;border-radius:50%}.lector-settings .mode-indicator{mix-blend-mode:normal !important;width:35px;height:25px}.lector-settings .modeOption{width:45px;height:25px;padding:10px 1px;display:flex;align-items:center;justify-content:center;background-color:transparent !important}.lector-settings .modeOption.inactive{background-color:transparent !important;opacity:.5 !important}.lector-settings .modeOption.active{opacity:1 !important}.lector-settings .modeOption.active::before{content:none}.lector-settings .modeOption .mini-pointer{height:70%;width:70%}.lector-settings .color-option{width:22px;height:22px;border-radius:25px;margin:5px 6px}.lector-settings .displayN{display:none}.lector-settings #underneath{margin:0 !important;position:relative}.lector-settings #mode{margin:35px 0;position:relative}.lector-settings #mode::before{width:70%;height:1px;background-color:#6F6F6F;content:\"\";position:absolute;top:-14px}.lector-settings #mode::after{width:70%;height:1px;background-color:#6F6F6F;content:\"\";position:absolute;bottom:-22px}.lector-settings #fovea{height:fit-content}.lector-settings #fovea .pragma-label{margin-top:-25px}.lector-settings #wpm .pragma-label{position:relative;left:0;margin:0;opacity:1;font-size:18px}.lector-mini-settings{right:-10px;padding-right:40px}.lector-mini-settings .section{margin-top:25px;margin-bottom:25px}.settings-input{display:flex;flex-direction:column;align-items:center}.pragma-input-text{font-family:'IBM Plex Mono',monospace;font-size:22px;border-style:none;outline:none;color:whitesmoke;border-radius:2px;background-color:transparent;text-align:center}.pragma-input-text:hover{background:#393939}.active-select-template{display:flex;flex-direction:row;flex-wrap:no wrap;justify-content:space-around;align-items:center;width:100%}.active-select-template .option{user-select:none;cursor:pointer}.active-select-template .active{opacity:1 !important;background-color:gray;position:relative;transform-style:preserve-3d}.active-select-template .active::after{height:32px;top:-6px;left:-10px}.active-select-template .active::before{width:30px;height:30px;top:-4px;border-radius:2px;left:-4px;background-color:#6F6F6F;position:absolute;border-radius:50%;content:\"\";z-index:-1;transform:translateZ(-1px);transition:ease all .2s;-webkit-transition:all 1s;-moz-transition:all 1s;animation:sheen 1s forwards}.active-select-template .inactive{background-color:#1a1a1a}.word-element{cursor:pointer;transition:all .05s ease;border-radius:1px}.word-element.hover-0{background-color:#2b6cce37;outline:2px solid #2b6cce37;border-radius:0}.word-element.hover-1{background-color:rgba(184,184,184,0.249)}.word-element.hover-2{background-color:rgba(184,184,184,0.119)}.word-element.hover-3{background-color:rgba(184,184,184,0.043)}",J="@charset \"utf-8\";@import url(https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;700&family=IBM+Plex+Sans:wght@300;400;700&display=swap);.collapsable,.setting,.settings{overflow:hidden;transition:all .2s ease-in-out;height:auto;flex:1}.collapsable.collapsed,.collapsed.setting,.collapsed.settings{flex:0}.settings{font-family:'IBM Plex Sans',sans-serif;font-size:18px;border-radius:4px;background-color:#404040;opacity:.98;bottom:10px;left:10px;height:auto;padding:10px 15px;width:200px;box-sizing:border-box;color:whitesmoke;position:fixed;display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-items:stretch;align-content:stretch}.settings [data-setting-target=back]{cursor:pointer;height:24px;display:flex;align-items:center;margin-bottom:27px}.settings [data-setting-target=back]::after{content:'';height:2px;width:120%;background-color:#6f6f66;position:absolute;top:40px;left:0}.settings [data-setting-target=back] .back-icon{margin-right:10px;margin-right:18px;margin-left:7px}.settings [data-setting-target=back] .back-copy{margin-bottom:3px}.setting{display:flex;flex-direction:column;justify-content:flex-start;height:30px;user-select:none;-webkit-user-select:none}.setting.expanded{height:200px}.setting.collapsed{height:0;flex:0}.setting .collapsed-section{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;align-items:center;align-content:stretch;cursor:pointer}.setting .editor-content .option{display:flex;margin:15px 0;cursor:pointer;opacity:70%}.setting .editor-content .option.selected{opacity:100%}.setting .color-blob{width:22px;height:22px;border-radius:30px;margin-right:10px}.setting .color-blob.selected{border:10px solid red}.setting .mode-icon{width:40px;height:26px;line-height:26px;margin-right:10px;text-align:center;box-sizing:border-box;font-size:16px;border:2px solid #fff;border-radius:2px}[data-setting='mode'] #Underneath{border-top:none;border-left:none;border-right:none}[data-setting='mode'] #Faded{border-left:none;border-right:none;margin-bottom:0 !important}[data-setting='mode'] [data-option='Underneath']{margin:27px 0 !important;display:flex;align-items:center}";function X(e={}){this._n=function(){let t=this.range||{min:1,max:100};return 100/(t.max||100-t.min||1)},this.do((function(){this.updateTo(this.value)})),this.updateTo=function(t){this.element.setData({value:t}),this._setBarTo(t*this._n())},this._setBarTo=t=>{this._bar.css(`width ${t}%`),this._thumb.offset()},this._clipValue=t=>{let e=Math.round(t/this._n());this._lv!==e&&(this.value=e)},this._input=t._e("div.").addClass("pragma-slider-bg"),this._bar=t._e("div.").addClass("pragma-slider-bar"),this._thumb=t._e("div.pragma-slider-thumb"),this._bar.append(this._thumb),this._input.append(this._bar);let i=function(){this._clicked=!0};this._input.listenTo("mousedown",i),this._thumb.listenTo("mousedown",i),document.addEventListener("mouseup",(()=>{this._input._clicked=!1}));let n=!1;document.addEventListener("mousemove",(t=>{this._input._clicked&&!n&&(window.requestAnimationFrame((()=>{n=!1;let e=t.pageX-this._input.offset().left,i=Math.round(100*Math.min(e/this._input.rect().width,1));this._clipValue(i)})),n=!0)})),this.adopt(this._input),this.append(this._input),this.element.addClass("pragma-slider")}function Y(e={}){t.util.createChains(this,"userInput"),this.input=t._e("<input type='text'></input>").addClass("pragma-input-text"),this.setValue=function(t){let e=this.valueSanitizer?this.valueSanitizer(t):t;if(e!==this._lv)return this.value=e,this.value!=e&&this.updateFront(),this},this.input.listenTo("focus",(function(){this.parent._listenToEsc=document.addEventListener("keydown",(t=>{"Enter"===t.key&&this.blur()}))})),this.input.listenTo("focusout",(function(){this.parent.setValue(this.value),this.parent.userInputChain.exec(this.parent.value),document.removeEventListener("keydown",this.parent._listenToEsc)})),this.adopt(this.input),this.append(this.input),this.setMonitorTemplate=function(t){return this._monitorTemplate=t,this},this.updateFront=function(t=this.value){this.input.value=this._monitorTemplate?this._monitorTemplate(t):t,this.input.placeholder=t},this.do((function(){this.updateFront(this.value)})),this.setInputAttrs=function(t){for(let[e,i]of Object.entries(t))this.input.attr(e,i);return this},this.setValueSanitizer=function(t){return this.valueSanitizer=t,this}}function Q(e={}){this.setLabel=function(t){return this._label.html(t),this},this._label=t._e("div.pragma-label",e.label),this.append(this._label)}function tt(){t.util.createChains(this,"idle","active"),this.setIdleTime=function(t=5e3){var e,i;return this._idler=(e=()=>{this.idleChain.exec()},i=()=>{this.activeChain.exec()},new v(t).onAfk((()=>{console.log("user is afk"),e&&e()})).onActive((()=>{console.log("user is back"),i&&i()}))),this},this.extend("onIdle",(function(){return this._onIdle(...arguments),this})),this.extend("onActive",(function(){return this._onActive(...arguments),this}))}t.util.addStyles(q);class et extends t.Pragma{constructor(t){super(),this.target=t,this.target.css("transition transform .07s ease; transform-origin top"),this.createWire("scale"),this.scale=100,this.on("scaleChange",(function(t,e){if(t==e)return!1;this.value=this.scale,this._scaleTo(this.scale)}))}setTarget(t){return this.target=t,this}set scaleStep(t){this._scaleStep=t}get scaleStep(){return this._scaleStep||5}scaleUp(){this.scale+=this.scaleStep}scaleDown(){this.scale-=this.scaleStep}scaleTo(t){this.scale=t}_scaleTo(t){this.target.css(`transform scale(${t/100})`)}}var it=["+","="],nt=["-"],st="]",ot="[",at="mod+=",rt="mod+-",lt={"speed-increase":'<svg width="17" height="9" viewBox="0 0 17 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M8.5 0L17 7.89474L15.81 9L8.5 2.21053L1.19 9L0 7.89474L8.5 0Z" fill="white"/>\n</svg>\n',"speed-decrease":'<svg width="17" height="9" viewBox="0 0 17 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M8.5 9L2.13343e-07 1.10526L1.19 -1.40286e-06L8.5 6.78947L15.81 -1.24738e-07L17 1.10526L8.5 9Z" fill="white"/>\n</svg>\n',"mode-icon":'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M22.75 3.5H5.25C4.78603 3.50053 4.34122 3.68508 4.01315 4.01315C3.68508 4.34122 3.50053 4.78603 3.5 5.25V22.75C3.50053 23.214 3.68508 23.6588 4.01315 23.9868C4.34122 24.3149 4.78603 24.4995 5.25 24.5H22.75C23.214 24.4995 23.6588 24.3149 23.9868 23.9868C24.3149 23.6588 24.4995 23.214 24.5 22.75V5.25C24.4995 4.78603 24.3149 4.34122 23.9868 4.01315C23.6588 3.68508 23.214 3.50053 22.75 3.5ZM19.25 22.75V19.25H15.75V22.75H12.25V19.25H8.75V15.75H12.25V12.25H8.75V8.75H12.25V5.25H15.75V8.75H19.25V5.25H22.75V22.75H19.25Z" fill="#909090"/>\n<path d="M15.75 8.75H12.25V12.25H15.75V8.75Z" fill="#909090"/>\n<path d="M15.75 15.75H12.25V19.25H15.75V15.75Z" fill="#909090"/>\n<path d="M19.25 12.25H15.75V15.75H19.25V12.25Z" fill="#909090"/>\n</svg>\n',"speed-icon":'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M22.4979 15.7501C22.4969 13.7461 21.9163 11.7851 20.8261 10.1035L19.7422 11.1875C20.564 12.5675 20.9978 14.1439 20.9979 15.7501L22.4979 15.7501Z" fill="#909090"/>\n<path d="M21 7.8105L19.9394 6.75L13.5143 13.1752C13.057 12.8997 12.5338 12.7528 12 12.75C11.4067 12.75 10.8266 12.9259 10.3333 13.2556C9.83994 13.5852 9.45543 14.0538 9.22836 14.602C9.0013 15.1501 8.94189 15.7533 9.05765 16.3353C9.1734 16.9172 9.45912 17.4518 9.87868 17.8713C10.2982 18.2909 10.8328 18.5766 11.4147 18.6924C11.9967 18.8081 12.5999 18.7487 13.1481 18.5216C13.6962 18.2946 14.1648 17.9101 14.4944 17.4167C14.8241 16.9234 15 16.3433 15 15.75C14.9972 15.2162 14.8503 14.693 14.5748 14.2357L21 7.8105ZM12 17.25C11.7033 17.25 11.4133 17.162 11.1666 16.9972C10.92 16.8324 10.7277 16.5981 10.6142 16.324C10.5007 16.0499 10.4709 15.7483 10.5288 15.4574C10.5867 15.1664 10.7296 14.8991 10.9393 14.6893C11.1491 14.4796 11.4164 14.3367 11.7074 14.2788C11.9983 14.2209 12.2999 14.2506 12.574 14.3642C12.8481 14.4777 13.0824 14.67 13.2472 14.9166C13.412 15.1633 13.5 15.4533 13.5 15.75C13.4995 16.1477 13.3414 16.529 13.0602 16.8102C12.779 17.0914 12.3977 17.2495 12 17.25Z" fill="#909090"/>\n<path d="M12 6.75002C13.6061 6.75077 15.1822 7.18457 16.5625 8.00574L17.6527 6.91554C16.0679 5.89651 14.2378 5.32343 12.3548 5.2566C10.4719 5.18976 8.60573 5.63164 6.95268 6.53575C5.29964 7.43986 3.92082 8.77277 2.96128 10.3943C2.00174 12.0158 1.49695 13.8659 1.50001 15.75L3.00001 15.75C3.00273 13.3639 3.95182 11.0763 5.63906 9.38906C7.32629 7.70182 9.6139 6.75274 12 6.75002Z" fill="#909090"/>\n</svg>\n',"color-icon":'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M19.75 0.5L2.25 0.5C1.78605 0.500579 1.34127 0.685139 1.0132 1.0132C0.685139 1.34127 0.500579 1.78605 0.5 2.25L0.5 19.75C0.500579 20.214 0.685139 20.6587 1.0132 20.9868C1.34127 21.3149 1.78605 21.4994 2.25 21.5L19.75 21.5C20.214 21.4994 20.6587 21.3149 20.9868 20.9868C21.3149 20.6587 21.4994 20.214 21.5 19.75L21.5 2.25C21.4994 1.78605 21.3149 1.34127 20.9868 1.0132C20.6587 0.685139 20.214 0.500579 19.75 0.5ZM2.25 19.75L19.75 2.25L19.75 19.75L2.25 19.75Z" fill="#919191"/>\n</svg>\n',"fovea-icon":'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M26.249 14L19.249 21L18.0117 19.7628L23.7745 14L18.0117 8.23725L19.249 7L26.249 14Z" fill="#909090"/>\n<path d="M14 19.25C13.8851 19.2502 13.7713 19.2276 13.6651 19.1836C13.559 19.1396 13.4625 19.075 13.3814 18.9937L9.00641 14.6187C8.92512 14.5374 8.86064 14.441 8.81664 14.3349C8.77265 14.2287 8.75 14.1149 8.75 14C8.75 13.8851 8.77265 13.7714 8.81664 13.6652C8.86064 13.5591 8.92512 13.4626 9.00641 13.3814L13.3814 9.00641C13.4626 8.92512 13.5591 8.86064 13.6652 8.81664C13.7713 8.77265 13.8851 8.75 14 8.75C14.1149 8.75 14.2287 8.77265 14.3349 8.81664C14.441 8.86064 14.5374 8.92512 14.6187 9.00641L18.9937 13.3814C19.0749 13.4626 19.1394 13.5591 19.1834 13.6652C19.2274 13.7714 19.2501 13.8851 19.2501 14C19.2501 14.1149 19.2274 14.2287 19.1834 14.3349C19.1394 14.441 19.0749 14.5374 18.9937 14.6187L14.6187 18.9937C14.5375 19.075 14.4411 19.1396 14.3349 19.1836C14.2288 19.2276 14.115 19.2502 14 19.25ZM10.8624 14L14 17.1377L17.1377 14L14 10.8624L10.8624 14Z" fill="#909090"/>\n<path d="M1.75 14L8.75 7L9.98725 8.23725L4.2245 14L9.98725 19.7628L8.75 21L1.75 14Z" fill="#909090"/>\n</svg>\n',"settings-icon-white":'<svg width="28" height="24" viewBox="0 0 28 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M27.0474 3.86392H23.0869C22.6039 1.64217 20.672 0 18.3536 0C16.0353 0 14.1033 1.64217 13.6203 3.86392H0V5.79588H13.6203C14.1033 8.01763 16.0353 9.65979 18.3536 9.65979C20.672 9.65979 22.6039 8.01763 23.0869 5.79588H27.0474V3.86392ZM18.3536 7.72784C16.7114 7.72784 15.4557 6.47206 15.4557 4.8299C15.4557 3.18773 16.7114 1.93196 18.3536 1.93196C19.9958 1.93196 21.2516 3.18773 21.2516 4.8299C21.2516 6.47206 19.9958 7.72784 18.3536 7.72784Z" fill="white"/>\n<path d="M0 19.3193H3.96052C4.44351 21.5411 6.37547 23.1832 8.69382 23.1832C11.0122 23.1832 12.9441 21.5411 13.4271 19.3193H27.0474V17.3874H13.4271C12.9441 15.1656 11.0122 13.5234 8.69382 13.5234C6.37547 13.5234 4.44351 15.1656 3.96052 17.3874H0V19.3193ZM8.69382 15.4554C10.336 15.4554 11.5918 16.7112 11.5918 18.3533C11.5918 19.9955 10.336 21.2513 8.69382 21.2513C7.05165 21.2513 5.79588 19.9955 5.79588 18.3533C5.79588 16.7112 7.05165 15.4554 8.69382 15.4554Z" fill="white"/>\n</svg>\n',"back-icon":'<svg width="7" height="13" viewBox="0 0 7 13" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M7.75117e-08 6.5L6.14035 7.3223e-08L7 0.91L1.7193 6.5L7 12.09L6.14035 13L7.75117e-08 6.5Z" fill="white"/>\n</svg>\n'};function ct(t,e){t.find(e).removeClass("active").addClass("inactive")}function ht(e){U.bind(this)(t.util.objDiff({onOptionCreate:(t,e)=>{t.contain(e),e.addClass("option"),ct(t,e.key)}},e)),this.addClass("active-select-template").do((function(){var t,e;this.value!==this._lv&&(t=this,e=this.value,t.find(e).addClass("active").removeClass("inactive"),this._lv&&ct(this,this._lv))}))}function pt(e){const i={changeColor(i=this.value){a.update(i),c.update(i),t._e("body").findAll("[data-lector-marker-color]").forEach((t=>{t.css(`${t.getData("lectorMarkerColor")} ${i}`)})),e.mark.setColor(i)},changeFovea(t=this.value){e.mark.setFovea(t)},changeWpm(t=this.value){e.mark.setWpm(t)},changeFont(t=this.value){e.setFont(t)},changeMode(i=this.value){e.mark.setMode(i),t._e("body").findAll("[data-lector-marker-mode]").forEach((t=>{I(t,i,e.mark._color)}))},changePage(t=this.value){e.paginator&&e.paginator.goTo(t)},changeScale(t=this.value){e.scaler&&e.scaler.scaleTo(t)}};let n=t._p("settingsWrapper").addClass("items-center","lector-settings").run((function(){this.value={},this._setVal=function(e){this.value=t.util.objDiff(this.value,e)},this.set=function(t){this._setting=!0;for(let[e,i]of Object.entries(t)){let t=this.find("!"+e);t&&(t.value=i)}this._setting=!1},this.get=function(t){return this.value[t]}}));let s=t._p().as(t._e(lt["mode-icon"])).addClass("setting-icon"),o=(t._p("monitor").as(t._e("div.")).addClass("mode-indicator").setData({lectorMarkerMode:"true"}),t._p("!mode").run((function(){ht.bind(this)({options:V,optionTemplate:e=>t._p(e).addClass("modeOption").listenTo("click",(function(){this.parent.value=this.key})).run((function(){this._miniPointer=t._e("div.mini-pointer#"),this.append(this._miniPointer),this.update=function(t){I(this._miniPointer,e,t),this._miniPointer.css("mix-blend-mode normal")}}))})})).run((function(){this.update=t=>{this.getOptions().forEach((e=>e.update(t)))}})).addClass("selector-mode").do(i.changeMode)),a=t._p().contain(s,o).addClass("setting").css("position relative").run((function(){this.update=o.update})),r=t._p().as(t._e(lt["fovea-icon"])).addClass("setting-icon"),l=(t._p("monitor").as(t._e("div.")).addClass("color-indicator").setData({lectorMarkerColor:"background"}),t._p("!fovea").addClass("selector-fovea").run(X).setRange(2,10).setValue(5).css("").do(i.changeFovea).run((function(){this.update=t=>{this._bar.css("")}}))),c=t._p().contain(r,l).addClass("setting").css("position relative").run((function(){this.update=l.update})),h=t._p("!color").run((function(){ht.bind(this)({options:D,optionTemplate:e=>t._p(e).css(`background-color ${e} `).addClass("color-option").listenTo("click",(function(){this.parent.value=this.key}))})})).addClass("selector").do(i.changeColor),p=t._p().as(t._e(lt["color-icon"])).css("width 25px; height 25px;").addClass("setting-icon"),d=(t._p("monitor").as(t._e("div.")).addClass("color-indicator").setData({lectorMarkerColor:"background"}),t._p().contain(p,h).addClass("setting").css("position relative")),u=t._p("popupsettings").contain(d.setId("color"),a.setId("mode"),c.setId("fovea")).addClass("pop-up-settings").run((function(){this.show=function(){this.hidden=!1,this.element.show()},this.hide=function(){this.hidden=!0,this.element.hide()},this.toggle=function(){this.hidden?this.show():this.hide()},this.show()})).bind("h",(function(){this.toggle()})),g=t._p().as(t._e(lt["speed-icon"])).css("width 25px; height 25px;").addClass("setting-icon"),m=t._p().as(t._e(lt["speed-increase"])).addClass("setting-wpm-adjusticon").listenTo("click",(t=>{b.value+=10})),f=t._p().as(t._e(lt["speed-decrease"])).addClass("setting-wpm-adjusticon").listenTo("click",(t=>{b.value-=10})),v=t._p("wpmAdjustPragma").contain(m,f).addClass("speed-adjust"),b=t._p("!wpm").run(Y,Q).addClass("settings-input").setInputAttrs({maxlength:4,size:4}).setValueSanitizer((t=>parseInt(t))).setId("wpm").setRange(40,4200).setValue(250).bind(it,(function(){this.value+=10})).bind(nt,(function(){this.value-=10})).do(i.changeWpm),w=t._p().contain(g,b,v).addClass("setting-wpm").run((function(){this.update=b.update})),x=t._p().as(t._e(lt["settings-icon-white"])).addClass("settings-bar-icon").run((function(){this.setPopupEditor=function(t){return this._popupEditor=t,this._popupEditor.addClass("displayN"),this},this.element.listenTo("click",(t=>{this._popped=t,this._popupEditor.removeClass("displayN")})),this.element.onRender((()=>{let t=this;document.addEventListener("click",(function(e){if(t._popped===e)return null;P(e,t._popupEditor)||t._popupEditor.addClass("displayN")}))}))})).setPopupEditor(u),y=t._p().contain(x,w).addClass("settings-bar"),_=t._p("!page").run(Y,Q).setInputAttrs({maxlength:4,size:4}).addClass("settings-input","section").setValueSanitizer((t=>parseInt(t))).setLabel("page").run((function(){t.util.createChains(this,"userEdit"),this.editValue=function(t){this.value=t,this.userEditChain.exec(this.value)},this.onUserEdit(i.changePage)})).run((function(){this.onUserInput((t=>{this.editValue(t)}))})).setValue(1).bind(st,(function(){this.editValue(this.value+1)}),"keyup").bind(ot,(function(){this.editValue(this.value-1)}),"keyup"),C=t._p("!scale").run(Y,Q).setInputAttrs({maxlength:3,size:4}).addClass("settings-input","section").setValueSanitizer((t=>parseInt(t))).setLabel("scale").run((function(){this.createEvent("userEdit"),this.createWire("scale").setScaleRange(40,200).setScale(100),this.editScale=function(t){this.setScale(t)},this.on("scaleChange",(t=>{this.value=this.scale,this.triggerEvent("userEdit")})),this.on("userEdit",i.changeScale)})).run((function(){this.onUserInput((t=>{this.editScale(t)}))})).setValue(100).bind(at,(function(){return this.editScale(this.value+5),!1})).bind(rt,(function(){return this.editScale(this.value-5),!1})),k=t._p("mini-settings").addClass("lector-mini-settings").contain(C,_).pragmatize();n.contain(u,y),n.adopt(k);let T=t._p("fader").run(tt,(function(){this.elements=[],this.include=function(){return this.elements=this.elements.concat(Array.from(arguments)),this}})).setIdleTime(3e3).include(n,k).onIdle((function(){this.elements.forEach((t=>{t.css("opacity 0")}))})).onActive((function(){this.elements.forEach((t=>t.css("opacity 1")))}));return n.fader=T,n.allChildren.forEach((t=>{var e;(e=t).key&&0===e.key.indexOf("!")&&t.do((e=>n._setVal({[t.key.substring(1)]:t.value})))})),n.do((function(){this._setting||console.log("syncing",this.value)})),n.set({font:$[1],fovea:4}),n.pragmatize()}class dt extends t.Pragma{constructor(){super(),this.init()}init(){this.settingsMap=new Map,this.pragmaMap=new Map,this.createEvents("update","load")}_set(t,e){return e!==this.settingsMap.get(t)&&this.settingsMap.set(t,e)}create(t,e){const i=e,n=t._events.get(`${e}Change`);if(this.pragmaMap.set(e,t),!n){let i=t[e];t.createWire(e),t[e]=i}this.adopt(t),t.on(`${e}Change`,(e=>{this.update(i,e,t)}))}update(t,e,i){e&&(t={[t]:e});for(let[e,n]of Object.entries(t))i||(console.log(e),this.pragmaMap.get(e)[`set${e.capitalize()}`](n)),this._set(e,n)&&this.triggerEvent("update",e,n,i)}get(...t){return 0==t.length&&(t=Array.from(this.pragmaMap.keys())),t.reduce(((t,e)=>("string"==typeof t?t={[t]:this.settingsMap.get(t)}:t[e]=this.settingsMap.get(e),t)))}toObj(){let t=new Map;for(let[e,i]of this.pragmaMap)t.set(e,i[e]);return t}toJSON(){return JSON.stringify(this.toObj())}}class ut extends t.Pragma{constructor(){super(),this.init(...arguments)}init(e){return this.setting=e,this.as((e=>t._e(`\n    <div id='${e.key}-editor' class='editor collapsable' data-setting-target='editor'>\n        <div data-setting-target='back'> \n            <div class="back-icon">${lt["back-icon"]}</div> \n            <div class="back-copy">${e.displayName||e.getData("setting")} </div>\n        </div>\n\n        <div class='editor-content' data-editor-target='content'>\n        </div>\n    </div>\n    `.trim()))(e)).appendTo(e.element),this.createEvents("hide"),this.createWire("content"),this.on("contentChange",(t=>{this._setContent(t)})),this.editorContent=this.element.find('[data-editor-target="content"]'),this.element.findAll("[data-setting-target='back']").forEach((t=>t.listenTo("mousedown",(()=>{this.triggerEvent("hide")})))),this.on("hide",(()=>{e.close(),E(this.element)})),E(this.element),this}_setContent(e,...i){"string"==typeof e?this.editorContent.html(e):e instanceof t.Pragma&&(this.editorContent.append(e,...i),this.triggerEvent("contentChange"))}}let gt=({key:e,title:i,htmlTemp:n=((t,e)=>`<div class='title' id='${t}-title'>${e}</div>`)})=>t._e(`div.collapsed-section.collapsable#${e}-section`).html(n(e,i)).append((e=>t._e(`div#${e}-display.display`,0).setData({settingTarget:"display"}))(e));class mt extends t.Pragma{constructor(...t){super(),this.init(...t)}init(e,i,n={displayName:i}){e.adopt(this),e.create(this,i),this.displayName=n.displayName||i,console.log("this display name",this.displayName),this.as(((e,i)=>t._e(`div.setting#${i}`).setData({setting:i}).append(gt({key:i,title:e.displayName})))(this,i)).createEvents("input").on("input",(function(t){this.updateDisplay(t)})).on(`${i}Change`,((t,e)=>{t!==e&&this.triggerEvent("input",t,e)})),this.element.find(".collapsed-section").listenTo("mousedown",(()=>{console.log("openedd"),this.open()})),this.editor=new ut(this)}open(){this.parent.element.findAll(".setting").forEach((t=>{t!==this.element&&E(t)})),this.element.findAll(".collapsed-section").forEach((t=>{console.log(t),E(t)})),setTimeout((()=>{this.addClass("expanded"),this._ogHeight=this.height,this.css(`height ${this.editor.element.scrollHeight}px`),L(this.editor)}),10)}close(){this.parent.element.findAll(".setting").forEach((t=>{t!==this.element&&L(t)})),this.element.findAll(".collapsed-section").forEach((t=>{console.log(t),L(t)})),this.removeClass("expanded"),this.element.style.height=null}updateDisplay(t){pragmaSpace.onDocLoad((()=>{let e=this.element.findAll("[data-setting-target='display']");console.log("updating",t,e),e.forEach((e=>e.html(t)))}))}}let ft=(e,i)=>t._p(`\n        <div class="option" data-editor-option=${i.getData("option")}>\n        </div>\n    `.trim()).run((function(){if("string"==typeof e)return this.element.html(e);this.append(e)})).element,vt=t=>t.key.toString(),bt=function(e,i){return this.as(t._e(i(e,this))).setId(t.util.rk5()).addClass("option"),this.setData({option:this.option}),this};class wt extends t.Pragma{constructor(){super(),this.createWire("optionTemplate"),this.init(...arguments)}static fromTemplate(t,e){let i="function"==typeof t?t:vt,n=ft;return"object"==typeof t&&(i=t.contentTemplate||optionDefaultTemplate,n=t.wrapperTemplate||ft),new wt(e,i,n).setKey(e)}init(t,e,i){this.option=t,this._contentTemplate=e,this._wrapperTemplate=i,this.render()}render(){return this.run((function(){bt.bind(this)(this._contentTemplate(this),this._wrapperTemplate)}))}}class xt extends mt{init(e,i,n={}){super.init(e,i,n);let s=n.options?n.options:n;if(console.log("configureee",n),"object"==typeof s){let t=[];for(let[e,i]of Object.entries(s))t.push(wt.fromTemplate(n,e).setData({description:i}).render());s=t}else s=s.map((t=>wt.fromTemplate(n,t)));this.adopt(...s),this.createEvent("select"),this.createWire("currentOption"),this.on("input",(e=>{let i=this.find(e);if(!i)return t.util.throwSoft(`couldnt find option for ${e}`);this.currentOption=i})),this.on("currentOptionChange",((t,e)=>{e&&t.key==e.key||this.triggerEvent("select",t,e)})),this.on("select",(t=>{this.parent.update(this.getData("setting"),t.getData("option"))})),s.forEach((t=>t.listenTo("mousedown",(()=>this.setCurrentOption(t))))),this.editor._setContent(...s)}}let yt=t=>"\n    <div data-setting-target='display'>240</div>\n".trim();class _t extends mt{init(t,e,i={contentTemplate:yt}){super.init(...arguments),this.editor._setContent(yt()),this.on("input",(t=>{console.log("set input",t),this.setData({value:t}),this.parent.update(this.getData("setting"),t,this)})),console.log(this.element.findAll("[data-setting-target='display']"))}}let Ct=t=>"\n    <div data-setting-target='display'>\n        8\n    </div>\n    <div data-setting-target='slider'> =====|-- </div>\n".trim();class kt extends mt{init(e,i,n={contentTemplate:Ct}){super.init(...arguments),this.slider=t._p().run(X).run((function(){n.min&&n.max&&this.setRange(n.min,n.max)})).do((()=>{this[i]=this.slider.value})),this.editor._setContent(Ct()),this.editor.element.findAll("[data-setting-target='slider']").forEach((t=>{t.html(" "),this.slider.appendTo(t)})),this.on("input",(t=>{console.log("set input",t),this.setData({value:t}),this.parent.update(this.getData("setting"),t,this),this.slider.updateTo(t)})),console.log(this.element.findAll("[data-setting-target='display']"))}}let Tt=t._e("div.settings");function Pt(e){const i={changeColor(i=this.value){t._e("body").findAll("[data-lector-marker-color]").forEach((t=>{t.css(`${t.getData("lectorMarkerColor")} ${i}`)})),e.mark.setColor(i)},changeFovea(t=this.value){e.mark.setFovea(t)},changeWpm(t=this.value){e.mark.setWpm(t)},changeFont(t=this.value){e.setFont(t)},changeMode(i=this.value){e.mark.setMode(i),t._e("body").findAll("[data-lector-marker-mode]").forEach((t=>{I(t,i,e.mark._color)}))},changePage(t=this.value){e.paginator&&e.paginator.goTo(t)},changeScale(t=this.value){e.scaler&&e.scaler.scaleTo(t)}};function n(t,e){t.addClass("selected"),e&&e.removeClass("selected")}e.settings=(new dt).as(Tt).appendTo("body").on("update",(function(t,e,i){console.log("syncing",this.toObj())})),console.log("[#] added settings to",e);let s=new xt(e.settings,"color",{displayName:"Color",options:F,contentTemplate:e=>`\n      ${function(e){let i=t._e("div.color-blob").css(`background-color ${e}`).setId(`${e}`).html("   "),n=t._e("div#color").append(i).html();return console.log("BLOOOOOOOOOb",n),n}(e.getData("option"))} ${e.getData("description")}\n  `.trim()}).on("select",n).on("select",(t=>{console.log("color is ",t.option),i.changeColor(t.option)}));let o=new xt(e.settings,"mode",{displayName:"Mode",options:z,contentTemplate:e=>`\n    ${function(e){let i=t._e("div.mode-icon").setId(`${e}`).html("W");return t._e("div#qwer").append(i).html()}(e.getData("option"))} ${e.getData("option")}\n  `.trim()}).on("select",n).on("select",(function(t){i.changeMode(t.getData("option")),console.log("MOOOOOOODE"),console.log(t.getData("option"))})),a=new _t(e.settings,"wpm",{displayName:"Speed"}).on("input",(t=>{i.changeWpm(t)})).bind("+",(function(){this.wpm+=5})).bind("-",(function(){this.wpm-=5})),r=new kt(e.settings,"fovea",{displayName:"Fovea",min:2,max:10}).on("input",(t=>{i.changeFovea(t)})).bind("]",(function(){this.fovea+=5})).bind("[",(function(){this.fovea-=5}));pragmaSpace.onDocLoad((function(){e.settings.update({color:"#eddd6e",mode:"HotBox",wpm:235,fovea:8}),e.settings.append(s,o,r,a),e.settings.triggerEvent("load")}))}var Et=Object.freeze({__proto__:null,LectorSettings:pt,Settings:dt,addSettingsToLector:Pt});const Lt={wfy:!0,pragmatizeOnCreate:!0,experimental:!1,settings:!1,defaultsStyles:!0},Mt=(t,e,i={shallow:!1})=>{let n=new A(e).as(t).setValue(0);function s(t,e="add"){function i(t,i){t[`${e}Class`](`hover-${i}`)}!function t(e,n=1,s=0){if(i(e,s),e.isInTheSameLine(1)&&n>s){t(e.next,n,s+1)}}(t,2),function t(e,n=1,s=0){if(s>0&&i(e,s),e.isInTheSameLine(-1)&&n>s){t(e.pre,n,s+1)}}(t,2)}let o=n.element.findAll("w");return e&&0===o.length&&(n.addClass("word-element"),n.listenTo("click",(function(){this.summon()})).listenTo("mouseover",(function(){s(this)})).listenTo("mouseout",(function(){s(this,"remove")}))),i.shallow||o.forEach(((t,e)=>{let i=Mt(t,e,{shallow:!0});n.add(i)})),n},St=(e,i=Lt)=>{e=t._e(e),i.wfy&&y(e);let n=Mt(e),s=new S("lector").as(e).setValue(0).connectTo(n);return s.mark=(t=>{let e=new B,i=!1,n=0;function s(){return n-Date.now()>-10}let o=0;return c((e=>{if(n=i?n:Date.now(),s()&&t.isReading){let i=Math.abs(o-e);o=e,i>40&&t.pause()}})),e.do((function(t){}),(function(n){if(s()||r(e.element)||i)return!1;i=!0;let o=[];t.isReading&&(t.pause(),o.push((()=>{t.read()}))),o.push((()=>{})),l(e).then((()=>{o.forEach((t=>t())),i=!1}))})),e})(s),i.settings&&Pt(s),i.legacySettings&&(s.settings=pt(s)),i.pragmatizeOnCreate&&s.pragmatize(),i.experimental&&globalThis.pragmaSpace.mousetrapIntegration&&(s.bind("right",(t=>s.goToNext())),s.bind("left",(t=>s.goToPre())),s.bind("space",(t=>!1),"keydown"),s.bind("space",(function(){return this.toggle(),!1}),"keyup")),s};const At=(e,i=Lt)=>{if(i.defaultStyles&&(t.util.addStyles(G),t.util.addStyles(J)),i.fullStyles&&t.util.addStyles(K),!(n=i).stream&&!n.paginate)return St(e,i);var n;if(t.util.log("configuration appears to be a bit more complicated"),!i.experimental)return console.log("EXPERIMENTAL FEATURES TURNED OFF");let s;if(i.stream&&i.paginate&&"stream"===i.paginate.from&&"infiniteScroll"===i.paginate.as){t.util.log("setting up streamer service");let n=(o=i.stream,t._p("streamer").setValue(0).run((function(){this.fetch=o,this.getContent=function(){return this.fetch(this.value)}}))),a=R(n,e,i.paginate.config||{});if(s=St(t._e(e).parentElement,i).adopt(a,n),s.paginator=a,s.settings){console.log("lector has settings! connecting paginator's value to pagecomp"),s.settings.find("!page")?.wireTo(s.paginator)}console.log("paginator",a),a.fill()}var o;if(i.scaler){let t=new et(s.element);if(t.scaleUp(),s.adopt(t),s.scaler=t,s.settings){console.log("lector has settings! connecting scaler's value to scalercomp");let t=s.settings.find("!scale");s.scaler.on("scaleChange",(e=>{t.value=e}))}}return s};exports.Lector=At,exports.Word=Mt,exports.globalify=function(){const e={Lector:At,Word:Mt,_e:t._e,_p:t._p,util:t.util,lecUtil:M,_thread:t._thread};for(let[t,i]of Object.entries(e))globalThis[t]=i},exports.helpers=M,exports.ui=Et;
